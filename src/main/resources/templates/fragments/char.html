<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Index</title>
    <link href="webjars/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"></link>
</head>
<body>

<th:block th:fragment="li-for-buff-change (character, projectItemsMap)">
    <th:block th:if="${#maps.size(projectItemsMap)>0}">

        <th:block th:each="mapEntry : ${projectItemsMap}" th:with="project = ${mapEntry.getKey()}, items = ${mapEntry.getValue()}">
            <!--/*@thymesVar id="project" type="dyn.model.Project"*/-->
            <li style="height: 34px;">
                <form th:action="@{/game/applyItemChangeSomething}" method="post" class="form-inline" style="margin-left: 10px;">
                    <input type="hidden" name="characterId" th:value="${character.getId()}"/>
                    <input type="hidden" name="itemId" th:value="${items.get(0).getId()}"/>
                    <button type="submit" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-ok"></span></button>
                    <th:block th:if="${project.getId() eq @const.PROJECT_BODY_PART_CHANGE}">
                        <div class="form-group">
                            <span th:text="${project.getName() + ' (' + #lists.size(items) + ' шт.): '}" style="padding-left: 5px;"></span>
                            <select class="form-control input-sm" name="param">
                                <option value="body">Тело</option>
                                <option value="ears">Уши</option>
                                <option value="eyebrows">Брови</option>
                                <option value="eyeColor">Цвет глаз</option>
                                <option value="eyes">Глаза</option>
                                <option value="hairColor">Цвет волос</option>
                                <option value="hairType">Тип волос</option>
                                <option value="head">Голова</option>
                                <option value="height">Рост</option>
                                <option value="mouth">Рот</option>
                                <option value="nose">Нос</option>
                                <option value="skinColor">Цвет кожи</option>
                            </select>
                        </div>
                    </th:block>
                    <th:block th:if="${project.getId() eq @const.PROJECT_VOCATION_CHANGE}">
                        <span th:text="${project.getName() + ' (' + #lists.size(items) + ' шт.): '}" style="padding-left: 5px;"></span>
                        <select class="form-control input-sm" name="param">
                            <option th:each="vocation : ${@vocationRepository.findAll()}" th:value="${vocation.getId()}" th:text="${vocation.getName()}">Тело</option>
                        </select>
                    </th:block>
                </form>
            </li>
        </th:block>

    </th:block>
</th:block>

<th:block th:fragment="li-for-buff-parents (character, projectItemsMap)">
    <th:block th:if="${#maps.size(projectItemsMap)>0}">
        <th:block th:each="mapEntry : ${projectItemsMap}" th:with="project = ${mapEntry.getKey()}, items = ${mapEntry.getValue()}">
            <li>
                <form th:action="@{/game/applyItemParents}" method="post" class="form-inline" style="margin-left: 10px;">
                    <input type="hidden" name="characterId" th:value="${character.getId()}"/>
                    <input type="hidden" name="itemId" th:value="${items.get(0).getId()}"/>
                    <button type="submit" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-ok"></span></button>
                    <span th:text="${project.getName() + ' (' + #lists.size(items) + ' шт.)'}" style="padding-left: 5px;"></span>
                </form>
            </li>
        </th:block>
    </th:block>
</th:block>

<th:block th:fragment="li-for-buff-improve-skill (character, projectItemsMap)">
    <th:block th:if="${#maps.size(projectItemsMap)>0}">
        <th:block th:each="mapEntry : ${projectItemsMap}" th:with="project = ${mapEntry.getKey()}, items = ${mapEntry.getValue()}">
            <li>
                <form th:action="@{/game/applyItemSkill}" method="post" class="form-inline" style="margin-left: 10px;">
                    <input type="hidden" name="characterId" th:value="${character.getId()}"/>
                    <input type="hidden" name="itemId" th:value="${items.get(0).getId()}"/>
                    <button type="submit" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-ok"></span></button>
                    <span th:text="${project.getName() + ' (' + #lists.size(items) + ' шт.)'}" style="padding-left: 5px;"></span>
                </form>
            </li>
        </th:block>
    </th:block>
</th:block>

<th:block th:fragment="li-for-buff-married (character, projectItemsMap)">
    <th:block th:if="${#maps.size(projectItemsMap)>0}">
        <th:block th:each="mapEntry : ${projectItemsMap}" th:with="project = ${mapEntry.getKey()}, items = ${mapEntry.getValue()}">
            <li>
                <form th:action="@{/game/applyItemMarried}" method="post" class="form-inline" style="margin-left: 10px;">
                    <input type="hidden" name="characterId" th:value="${character.getId()}"/>
                    <input type="hidden" name="itemId" th:value="${items.get(0).getId()}"/>
                    <button type="submit" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-ok"></span></button>
                    <span th:text="${project.getName() + ' (' + #lists.size(items) + ' шт.)'}" style="padding-left: 5px;"></span>
                </form>
            </li>
        </th:block>
    </th:block>
</th:block>

<th:block th:fragment="li-for-improve-education (character)">
    <!--/*@thymesVar id="character" type="dyn.model.Character"*/-->
    <li th:if="${@careerService.mayImproveEducation(character.getCareer())}">
        <form th:action="@{/game/improveEducation}" method="post" style="margin-left: 10px;">
            <input type="hidden" name="character" th:value="${character.getId()}"/>
            <button type="submit" class="btn btn-primary btn-xs" th:disabled="${character.getFamily().getMoney() lt @const.EDUCATION_IMPROVE_COST}"><span class="glyphicon glyphicon-ok"></span></button>
            <span th:text="${'Повысить образование (' + @const.EDUCATION_IMPROVE_COST + ' р.)'}" style="padding-left: 5px;"></span>
        </form>
    </li>
</th:block>

<th:block th:fragment="char-panel (character)">
    <!--/*@thymesVar id="character" type="dyn.model.Character"*/-->
    <div class="panel " th:classappend="${character.getSex() == 'male'?'panel-info':'panel-danger'}" style="width: 200px; margin-bottom: 0px;">
        <div class="panel-heading" align="center" style="padding: 0">
            <span th:text="${character.getName()+ ' (' + character.getId() + ')'}" data-toggle="tooltip" th:alt-title="${character.getFullName()}"></span>
            <br/>
            <p align="center" style="font-size: 10px; margin: 0px;" data-toggle="tooltip" th:alt-title="${'Раса'}">
                <span th:if="${character.getRace().getId() == 1}" th:text="${character.getRace().getName()}"></span>
                <span th:unless="${character.getRace().getId() == 1}" th:text="${character.getRace().getName()}" style="color:DarkOrchid"></span>
            </p>
        </div>
        <div style="position: relative">
            <img height="200px" width="200px"
                 th:src="@{'data:image/png;base64,'+${character.getEncodedView()}}"
                 data-toggle="tooltip" th:alt-title="#{tooltip(
                                           ${character.getFullName()},
                                           #{${character.getBody().getName()}}+${character.getBody().isRare()?'*':''},
                                           #{${character.getEars().getName()}}+${character.getEars().isRare()?'*':''},
                                           #{${character.getEyebrows().getName()}}+${character.getEyebrows().isRare()?'*':''},
                                           #{${character.getEyeColor().getName()}}+${character.getEyeColor().isRare()?'*':''},
                                           #{${character.getEyes().getName()}}+${character.getEyes().isRare()?'*':''},
                                           #{${character.getHairColor().getName()}}+${character.getHairColor().isRare()?'*':''},
                                           #{${character.getHairStyle().getName()}},
                                           #{${character.getHairType().getName()}}+${character.getHairType().isRare()?'*':''},
                                           #{${character.getHead().getName()}}+${character.getHead().isRare()?'*':''},
                                           #{${character.getHeight().getName()}}+${character.getHeight().isRare()?'*':''},
                                           #{${character.getMouth().getName()}}+${character.getMouth().isRare()?'*':''},
                                           #{${character.getNose().getName()}}+${character.getNose().isRare()?'*':''},
                                           #{${character.getSkinColor().getName()}}+${character.getSkinColor().isRare()?'*':''})}"
                 data-placement="right"/>
            <!--<div style="position: absolute; top: 0" th:each="buff : ${character.getBuffs()}">-->
            <th:block th:each="buff : ${character.getBuffs()}" th:with="count=${(buffStat.count-1) * 20}">
                <!--/*@thymesVar id="buff" type="dyn.model.Buff"*/-->
                <img th:src="@{'/graphics/buffs/buffs_'+${buff.getId() lt 10?'0'+buff.getId():buff.getId()}+'.png' }"
                     data-toggle="tooltip" th:alt-title="#{${buff.getTitle()}} + ': ' + #{${buff.getDescription()}}"
                     th:height="${imsize}==null?20:50" th:style="${'position: absolute; top: '+count+'px; left: 0'}">
                </img>
            </th:block>
            <!--</div>-->
        </div>
        <button type="button" th:with="career = ${character.getCareer()}" class="btn btn-xs btn-primary" style="width: 199px; height: 58px; border-top-left-radius: 0; border-top-right-radius: 0">
            <table>
                <tr>
                    <td width="35px">
                        <a th:href="${'/game/vocation?vocationId=' + career.getVocation().getId()}" style="text-decoration: none;">
                            <img th:src="@{'/graphics/vocation/vocations_'+${career.getVocation().getId()}+'.png' }" data-toggle="tooltip"
                                 th:alt-title="${'Призвание: ' + career.getVocation().getName() + '. Приносит ресурсы: ' + career.getVocation().resString(1)}"
                                 height="35px" width="35px">
                            </img>
                        </a>
                    </td>
                    <td width="19px">
                        <div style="position: relative; "
                             data-toggle="tooltip" th:title="${'Образование: '+career.getEducation().getName()+(@careerService.mayImproveEducation(career)==true?'. Можно повысить!':'')}">
                            <span class="glyphicon glyphicon-education" style="position: absolute; top: -15px; left: 3px;"></span>
                            <span th:if="${career.getEducation().getId() == 2}" class="glyphicon glyphicon-education" style="position: absolute; top: -5px; left: 3px;"></span>
                            <span th:if="${career.getEducation().getId() == 3}" class="glyphicon glyphicon-education" style="position: absolute; top: 5px; left: 3px;"></span>
                            <span th:if="${@careerService.mayImproveEducation(career)}" class="glyphicon glyphicon-upload" style="position: absolute; top: 4px; color: orange; left: 3px;"></span>
                        </div>
                    </td>
                    <td>
                        <span th:text="${career.getIntelligence()}" class="badge" data-toggle="tooltip" title="Интеллект" style="width: 31px;"></span>&nbsp;
                        <span th:text="${career.getCharisma()}" class="badge" data-toggle="tooltip" title="Харизма" style="width: 31px;">5</span><br/>
                        <span th:text="${career.getStrength()}" class="badge" data-toggle="tooltip" title="Сила" style="width: 31px;">100</span>&nbsp;
                        <span th:text="${career.getCreativity()}" class="badge" data-toggle="tooltip" title="Творчество" style="width: 31px;">5</span>
                    </td>
                    <td style="padding-left: 4px; padding-top: 2px;">
                        <th:block th:if="${character.getSpouse() != null}">
                            <img th:src="@{'/graphics/family_status_married.png' }" height="35px" width="35px"
                                 data-toggle="tooltip" th:alt-title="${'Семейное положение: '+(character.getSex() == 'male'?'женат':'замужем')}">
                            </img>
                        </th:block>
                        <th:block th:if="${character.isFiancee()}">
                            <img th:src="@{'/graphics/family_status_bride.png' }" height="35px" width="35px"
                                 data-toggle="tooltip" th:alt-title="${'Семейное положение: в базе невест за ' + character.getFiancee().getCost() + ' р.'}">
                            </img>
                        </th:block>
                    </td>
                </tr>
                <tr>
                    <td>

                    </td>
                </tr>
            </table>


            <th:block th:if="${career.getProfession()!=null}">
                        <span th:text="${career.getProfession().getName()+'(' + career.getProfession().getLevel() + ')'}"
                              data-toggle="tooltip" th:alt-title="Профессия">
                        </span>
            </th:block>
            <th:block th:unless="${career.getProfession()!=null}">
                &nbsp;
            </th:block>
        </button>

        <!--<div class="btn-group">
            <button type="button" th:with="career = ${character.getCareer()}" class="btn btn-xs btn-primary" style="width: 173px; height: 58px; border-top-left-radius: 0;">
                <table>
                    <tr>
                        <td width="35px">
                            <img th:src="@{'/graphics/vocation/vocations_'+${career.getVocation().getId()}+'.png' }" data-toggle="tooltip"
                                 th:alt-title="${'Призвание: ' + career.getVocation().getName() + '. Приносит ресурсы: ' + career.getVocation().resString(1)}"
                                 height="35px" width="35px">
                            </img>
                        </td>
                        <td width="19px">
                            <div style="position: relative; "
                                 data-toggle="tooltip" th:title="${'Образование: '+career.getEducation().getName()+(@careerService.mayImproveEducation(career)==true?'. Можно повысить!':'')}">
                                <span class="glyphicon glyphicon-education" style="position: absolute; top: -15px; left: 3px;"></span>
                                <span th:if="${career.getEducation().getId() == 2}" class="glyphicon glyphicon-education" style="position: absolute; top: -5px; left: 3px;"></span>
                                <span th:if="${career.getEducation().getId() == 3}" class="glyphicon glyphicon-education" style="position: absolute; top: 5px; left: 3px;"></span>
                                <span th:if="${@careerService.mayImproveEducation(career)}" class="glyphicon glyphicon-upload" style="position: absolute; top: 4px; color: orange; left: 3px;"></span>
                            </div>
                        </td>
                        <td>
                            <span th:text="${career.getIntelligence()}" class="badge" data-toggle="tooltip" title="Интеллект" style="width: 31px;"></span>&nbsp;
                            <span th:text="${career.getCharisma()}" class="badge" data-toggle="tooltip" title="Харизма" style="width: 31px;">5</span><br/>
                            <span th:text="${career.getStrength()}" class="badge" data-toggle="tooltip" title="Сила" style="width: 31px;">100</span>&nbsp;
                            <span th:text="${career.getCreativity()}" class="badge" data-toggle="tooltip" title="Творчество" style="width: 31px;">5</span>
                        </td>
                        <td style="padding-left: 4px; padding-top: 2px;">
                            <th:block th:if="${character.getSpouse() != null}">
                                <img th:src="@{'/graphics/family_status_married.png' }" height="35px" width="35px"
                                     data-toggle="tooltip" th:alt-title="${'Семейное положение: '+(character.getSex() == 'male'?'женат':'замужем')}">
                                </img>
                            </th:block>
                            <th:block th:if="${character.isFiancee()}">
                                <img th:src="@{'/graphics/family_status_bride.png' }" height="35px" width="35px"
                                     data-toggle="tooltip" th:alt-title="${'Семейное положение: в базе невест за ' + character.getFiancee().getCost() + ' р.'}">
                                </img>
                            </th:block>
                        </td>
                    </tr>
                    <tr>
                        <td>

                        </td>
                    </tr>
                </table>


                <th:block th:if="${career.getProfession()!=null}">
                    <span th:text="${career.getProfession().getName()+'(' + career.getProfession().getLevel() + ')'}"
                          data-toggle="tooltip" th:alt-title="Профессия">
                    </span>
                </th:block>
                <th:block th:unless="${career.getProfession()!=null}">
                    &nbsp;
                </th:block>
            </button>
            <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="height: 58px; border-top-right-radius: 0;">
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel" style="width: 200px;">
                <li><a href="#">Action</a></li>
                <li th:if="${character.getSex() == 'male' and character.getSpouse() == null and family.getPairsNum() lt family.getHouse().getPairsNum()}"
                    data-toggle="tooltip" th:title="'Можно создать еще пар: '+${family.getHouse().getPairsNum()-family.getPairsNum()}">
                    <form th:action="@{/game/chooseFiancee}" method="post" id="form_choose_fiancee" style="padding: 3px 20px;">
                        <input type="hidden" name="characterId" th:value="${character.getId()}"/>
                        <button class="btn btn-xs btn-info" name="postFianceeButton" type="submit" style="width: 160px;">Выбрать невесту</button>
                    </form>
                </li>
                <li th:if="${character.getSex() == 'female' and character.getSpouse() == null and character.isFiancee() == false and family.getFianceeNum() lt family.getHouse().getFianceeNum()}"
                    data-toggle="tooltip" th:title="'Чтобы поместить анкету этого персонажа в базу невест, введите стоимость выкупа и нажмите кнопку. Можно опубликовать еще анкет: '+${family.getHouse().getFianceeNum()-family.getFianceeNum()}">
                    <a href="#">Анкета невесты:</a>
                    <form class="form-inline" th:action="@{/game/putUpForFiancee}" method="post" style="margin-left: 60px;">
                        <input type="text" name="cost" class="form-control" th:value="${family.getLevel()}*50" style="width: 60px;height: 23px;margin-left: 4px;"/>
                        <input type="hidden" name="female" th:value="${character.getId()}"/>
                        <button class="btn btn-xs btn-info" name="postFianceeButton" type="submit"><span class="glyphicon glyphicon-ok"></span></button>
                    </form>
                </li>
                <li th:if="${@careerService.mayImproveEducation(character.getCareer())}">
                    <form th:action="@{/game/improveEducation}" method="post" id="form_improve_education" style="padding: 3px 20px;">
                        <input type="hidden" name="character" th:value="${character.getId()}"/>
                        <button class="btn btn-xs btn-info" name="postFianceeButton" type="submit" style="width: 160px;">Повысить образование</button>
                    </form>
                </li>
                <li role="separator" class="divider"></li>

                <li><a href="#">Separated link</a></li>
                <li class="dropdown-submenu">
                    <a class="test" tabindex="-1" href="#">Применить баффы<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a tabindex="-1" href="#">Повышение навыка</a>
                        </li>
                        <li><a tabindex="-1" href="#">Бафф на женатого сына</a></li>
                        <li><a tabindex="-1" href="#">2nd level dropdown</a></li>
                        <li class="dropdown-submenu">
                            <a class="test" href="#">Another dropdown <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">3rd level dropdown</a></li>
                                <li><a href="#">3rd level dropdown</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>-->

    </div>


</th:block>
<div th:fragment="char-view (character)">
    <!--/*@thymesVar id="character" type="dyn.model.Character"*/-->
    <p align="center" style="margin-bottom: 3px;">
        <span th:text="${character.getName()}" data-toggle="tooltip" th:alt-title="${character.getFullName()}"></span>
    </p>
    <p align="center" style="font-size: 10px; margin: 0px;" data-toggle="tooltip" th:alt-title="${'Раса'}">
        <span th:if="${character.getRace().getId() == 1}" th:text="${character.getRace().getName()}"></span>
        <span th:unless="${character.getRace().getId() == 1}" th:text="${character.getRace().getName()}" style="color:DarkOrchid"></span>
    </p>
    <div align="center" style="font-size: 10px; margin: 0px;">
        <a th:href="${'/game/vocation?vocationId=' + character.getCareer().getVocation().getId()}" style="text-decoration: none;">
            <img th:src="@{'/graphics/vocation/vocations_'+${character.getCareer().getVocation().getId()}+'.png' }" data-toggle="tooltip"
                 th:alt-title="${'Призвание: ' + character.getCareer().getVocation().getName() + '. Приносит ресурсы: ' + character.getCareer().getVocation().resString(1)}"
                 th:height="${imsize==null?20:50}" th:width="${imsize == null?20:50}">
            </img>
        </a>
        <span th:text="${character.getCareer().getIntelligence()}" data-toggle="tooltip" title="Интеллект"></span>|
        <span th:text="${character.getCareer().getCharisma()}" data-toggle="tooltip" title="Харизма"></span>|
        <span th:text="${character.getCareer().getStrength()}" data-toggle="tooltip" title="Сила"></span>|
        <span th:text="${character.getCareer().getCreativity()}" data-toggle="tooltip" title="Творчество"></span>
        <img th:src="@{'/graphics/education/'+${character.getCareer().getEducation().getId()}+'.png' }"
             data-toggle="tooltip" th:alt-title="'Образование: '+${character.getCareer().getEducation().getName()}"
             th:height="${imsize}==null?20:50">
        </img>
        <th:block th:if="${education==true}">
            <form th:action="@{/game/improveEducation}" method="post" style="float:right">
                <input type="hidden" name="character" th:value="${character.getId()}"/>
                <!--<a href='#' onClick='submit()' style="font-size: 8px; margin: 0px; color:red;">Повысить</a>-->
                <!--<button class="btn btn-xs btn-primary" type="submit" data-toggle="tooltip" th:title="Повысить">^</button>-->
                <input type="image" th:src="@{'/graphics/button_improve.png'}"
                       data-toggle="tooltip" title="Повысить образование"
                       th:height="${imsize}==null?20:50"/>
            </form>
        </th:block>
        <br/>
        <th:block th:if="${character.getCareer().getProfession()!=null}">
            <span th:text="${character.getCareer().getProfession().getName()+'(' + character.getCareer().getProfession().getLevel() + ')'}" style="color:midnightblue"
                  data-toggle="tooltip" th:alt-title="Профессия">
            </span>
        </th:block>
    </div>
    <a href="/game/character" th:href="${nolink}==null?@{/game/character(characterId=${character.getId()})}:''">
        <img th:class="${character.getSex()} == 'male' ? male : female" th:height="${imsize}==null?100:${imsize}"
             th:width="${imsize}==null?100:${imsize}"
             th:src="@{'data:image/png;base64,'+${character.getEncodedView()}}"
             data-toggle="tooltip" th:alt-title="#{tooltip(
                                           ${character.getFullName()},
                                           #{${character.getBody().getName()}}+${character.getBody().isRare()?'*':''},
                                           #{${character.getEars().getName()}}+${character.getEars().isRare()?'*':''},
                                           #{${character.getEyebrows().getName()}}+${character.getEyebrows().isRare()?'*':''},
                                           #{${character.getEyeColor().getName()}}+${character.getEyeColor().isRare()?'*':''},
                                           #{${character.getEyes().getName()}}+${character.getEyes().isRare()?'*':''},
                                           #{${character.getHairColor().getName()}}+${character.getHairColor().isRare()?'*':''},
                                           #{${character.getHairStyle().getName()}},
                                           #{${character.getHairType().getName()}}+${character.getHairType().isRare()?'*':''},
                                           #{${character.getHead().getName()}}+${character.getHead().isRare()?'*':''},
                                           #{${character.getHeight().getName()}}+${character.getHeight().isRare()?'*':''},
                                           #{${character.getMouth().getName()}}+${character.getMouth().isRare()?'*':''},
                                           #{${character.getNose().getName()}}+${character.getNose().isRare()?'*':''},
                                           #{${character.getSkinColor().getName()}}+${character.getSkinColor().isRare()?'*':''})}"
             data-placement="right"/>

    </a>
    <div>
        <div style="display: inline-block;" th:each="buff : ${character.getBuffs()}">
            <img th:src="@{'/graphics/buffs/buffs_'+${buff.getId() lt 10?'0'+buff.getId():buff.getId()}+'.png' }"
                 data-toggle="tooltip" th:alt-title="#{${buff.getTitle()}} + ': ' + #{${buff.getDescription()}}"
                 th:height="${imsize}==null?20:50">
            </img>
        </div>
    </div>
</div>

<script src="webjars/jquery/1.9.1/jquery.min.js"></script>
<script src="webjars/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>